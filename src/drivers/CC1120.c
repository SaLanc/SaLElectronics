#include <CC1120.h>


/*
 * RDF deviation is 5kHz
 *
 *	fdev = fosc >> 24 * (256 + dev_m) << dev_e
 *
 *     	32e6Hz / (2 ** 24) * (256 + 71) * (2 ** 3) = 4989
 */

#define RDF_DEV_E	3
#define RDF_DEV_M	71
#define RDF_PACKET_LEN	50

/*
 * For our RDF beacon, set the symbol rate to 2kBaud (for a 1kHz tone)
 *
 *              (2**20 + DATARATE_M) * 2 ** DATARATE_E
 *	Rdata = -------------------------------------- * fosc
 *		             2 ** 39
 *
 *	DATARATE_M = 25166
 *	DATARATE_E = 5
 *
 * To make the tone last for 200ms, we need 2000 * .2 = 400 bits or 50 bytes
 */
#define RDF_DRATE_E	5
#define RDF_DRATE_M	25166
#define RDF_PACKET_LEN	50

static const uint16_t rdf_setup[] = {
    CC1120_DEVIATION_M,	RDF_DEV_M,
    CC1120_MODCFG_DEV_E,	((CC1120_MODCFG_DEV_E_MODEM_MODE_NORMAL << CC1120_MODCFG_DEV_E_MODEM_MODE) |
    (CC1120_MODCFG_DEV_E_MOD_FORMAT_2_GFSK << CC1120_MODCFG_DEV_E_MOD_FORMAT) |
    (RDF_DEV_E << CC1120_MODCFG_DEV_E_DEV_E)),
    CC1120_DRATE2,		((RDF_DRATE_E << CC1120_DRATE2_DATARATE_E) |
    (((RDF_DRATE_M >> 16) & CC1120_DRATE2_DATARATE_M_19_16_MASK) << CC1120_DRATE2_DATARATE_M_19_16)),
    CC1120_DRATE1,		((RDF_DRATE_M >> 8) & 0xff),
    CC1120_DRATE0,		((RDF_DRATE_M >> 0) & 0xff),
    CC1120_PKT_CFG2,	((CC1120_PKT_CFG2_CCA_MODE_ALWAYS_CLEAR << CC1120_PKT_CFG2_CCA_MODE) |
    (CC1120_PKT_CFG2_PKT_FORMAT_NORMAL << CC1120_PKT_CFG2_PKT_FORMAT)),
    CC1120_PKT_CFG1,	((0 << CC1120_PKT_CFG1_WHITE_DATA) |
    (CC1120_PKT_CFG1_ADDR_CHECK_CFG_NONE << CC1120_PKT_CFG1_ADDR_CHECK_CFG) |
    (CC1120_PKT_CFG1_CRC_CFG_DISABLED << CC1120_PKT_CFG1_CRC_CFG) |
    (0 << CC1120_PKT_CFG1_APPEND_STATUS)),
    CC1120_PKT_CFG0,	((0 << CC1120_PKT_CFG0_RESERVED7) |
    (CC1120_PKT_CFG0_LENGTH_CONFIG_FIXED << CC1120_PKT_CFG0_LENGTH_CONFIG) |
    (0 << CC1120_PKT_CFG0_PKG_BIT_LEN) |
    (0 << CC1120_PKT_CFG0_UART_MODE_EN) |
    (0 << CC1120_PKT_CFG0_UART_SWAP_EN)),
    CC1120_PREAMBLE_CFG1,	((CC1120_PREAMBLE_CFG1_NUM_PREAMBLE_NONE << CC1120_PREAMBLE_CFG1_NUM_PREAMBLE) |
    (CC1120_PREAMBLE_CFG1_PREAMBLE_WORD_AA << CC1120_PREAMBLE_CFG1_PREAMBLE_WORD)),
    CC1120_PA_CFG0,		0x7e,
};